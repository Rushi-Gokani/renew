
<script
  src="{{ 'results-list.js' | asset_url }}"
  type="module"
  fetchpriority="low"
></script>

{% liquid
  assign col = section.settings.collection | default: collections.all
%}

<div class="section-background color-{{ section.settings.color_scheme }}"></div>
<results-list
  class="section product-grid-container color-{{ section.settings.color_scheme }}"
  style="--padding-block-start: {{ section.settings.padding_block_start }}px; --padding-block-end: {{ section.settings.padding_block_end }}px;"
  section-id="{{ section.id }}"
>
  <div class="cbm-toolbar">
    <a class="cbm-toggle" href="{{ col.url }}?filter.p.tag={{ section.settings.toggle_tag }}">
      <span class="cbm-toggle__knob" aria-hidden="true"></span>
      {{ section.settings.toggle_label }}
    </a>
    {% for i in (1..3) %}
      {% assign label = section.settings["chip_" | append: i | append: "_label"] %}
      {% assign value = section.settings["chip_" | append: i | append: "_value"] %}
      {% if label and value %}
        <a class="cbm-chip" href="{{ col.url }}?filter.p.tag={{ value }}">
          {{ label }}
        </a>
      {% endif %}
    {% endfor %}
  </div>

  <div class="cbm-layout">
    <aside class="cbm-filters" role="complementary">
      <h3 class="cbm-filters__heading">By Health Goal</h3>
      {% for filter in col.filters %}
        {% if filter.param_name contains 'filter.p.tag' %}
          <div class="cbm-filter-group">
            <ul class="cbm-filter-list">
              {% for v in filter.values %}
                <li>
                  <a class="cbm-filter{% if v.active %} is-active{% endif %}" href="{% if v.active %}{{ v.url_to_remove }}{% else %}{{ v.url_to_add }}{% endif %}">
                    <span class="cbm-check" aria-hidden="true"></span>
                    {{ v.label }}
                  </a>
                </li>
              {% endfor %}
            </ul>
          </div>
        {% endif %}
      {% endfor %}

      <h3 class="cbm-filters__heading">Product Type</h3>
      {% for filter in col.filters %}
        {% if filter.param_name contains 'filter.p.product_type' %}
          <div class="cbm-filter-group">
            <ul class="cbm-filter-list">
              {% for v in filter.values %}
                <li>
                  <a class="cbm-filter{% if v.active %} is-active{% endif %}" href="{% if v.active %}{{ v.url_to_remove }}{% else %}{{ v.url_to_add }}{% endif %}">
                    <span class="cbm-check" aria-hidden="true"></span>
                    {{ v.label }}
                  </a>
                </li>
              {% endfor %}
            </ul>
          </div>
        {% endif %}
      {% endfor %}
    </aside>

    {% paginate col.products by section.settings.per_page %}
      <div class="cbm-results">
        <div class="cbm-results__meta">
          <div class="cbm-count">Showing {{ paginate.items }} results</div>
          <a class="cbm-reset" href="{{ col.url }}">Reset all filters</a>
        </div>

        <ul id="ResultsList" class="cbm-grid" role="list">
          {% for product in col.products %}
            <li class="cbm-card">
              <a class="cbm-media" href="{{ product.url }}">
                {% if product.featured_media %}
                  {{ product.featured_media | image_url: width: 1200 | image_tag: loading: 'lazy', sizes: '(min-width: 990px) 30vw, (min-width: 750px) 45vw, 100vw', class: 'cbm-img' }}
                {% else %}
                  <div class="cbm-ph"></div>
                {% endif %}
              </a>
              <div class="cbm-card__content">
                <h3 class="cbm-title"><a href="{{ product.url }}">{{ product.title }}</a></h3>
                <div class="cbm-excerpt">{{ product.description | strip_html | truncate: 120 }}</div>
                <div class="cbm-price">
                  {% if product.compare_at_price > product.price %}
                    <span class="cbm-price--compare">{{ product.compare_at_price | money }}</span>
                  {% endif %}
                  <span class="cbm-price--now">{{ product.price | money }}</span>
                </div>
                {% assign v = product.selected_or_first_available_variant %}
                <form method="post" action="/cart/add" class="cbm-form">
                  <input type="hidden" name="id" value="{{ v.id }}">
                  <input type="hidden" name="quantity" value="1">
                  <button type="submit" class="cbm-btn" {% unless product.available %}disabled{% endunless %}>Add to Cart</button>
                </form>
              </div>
            </li>
          {% endfor %}
        </ul>

        {% if paginate.pages > 1 %}
          <nav class="cbm-pagination" role="navigation">
            {% if paginate.previous %}<a class="cbm-page" href="{{ paginate.previous.url }}">Previous</a>{% endif %}
            <span class="cbm-page-count">{{ paginate.current_page }} / {{ paginate.pages }}</span>
            {% if paginate.next %}<a class="cbm-page" href="{{ paginate.next.url }}">Next</a>{% endif %}
          </nav>
        {% endif %}
      </div>
    {% endpaginate %}
  </div>
</results-list>

{% stylesheet %}
  :root {
    --cbm-pill-bg: #f0f3ed;
    --cbm-pill-bg-active: #e3efe0;
    --cbm-pill-border: #d7ddcf;
  }
  .cbm-toolbar { display: flex; gap: 12px; align-items: center; padding-inline: var(--page-margin); margin-bottom: 12px; }
  .cbm-toggle, .cbm-chip { display: inline-flex; align-items: center; gap: 8px; padding: 10px 14px; border-radius: 999px; background: var(--cbm-pill-bg); border: 1px solid var(--cbm-pill-border); text-decoration: none; color: var(--color-foreground); box-shadow: 0 1px 0 rgba(0,0,0,.04); }
  .cbm-toggle__knob { width: 34px; height: 34px; border-radius: 999px; background: #d6ddcf; position: relative; }
  .cbm-toggle__knob::after { content: ''; position: absolute; top: 3px; left: 3px; width: 28px; height: 28px; border-radius: 50%; background: #fff; box-shadow: 0 1px 2px rgba(0,0,0,.15); }

  .cbm-layout { display: grid; grid-template-columns: 1fr; gap: 24px; align-items: start; }
  @media screen and (min-width: 990px) { .cbm-layout { grid-template-columns: 280px 1fr; } }

  .cbm-filters { position: sticky; top: 24px; align-self: start; }
  .cbm-filters__heading { font-weight: 600; margin: 0 0 8px; }
  .cbm-filter-group { margin: 8px 0 20px; }
  .cbm-filter-list { list-style: none; margin: 0; padding: 0; display: grid; gap: 8px; }
  .cbm-filter { display: inline-flex; align-items: center; gap: 10px; text-decoration: none; color: var(--color-foreground); }
  .cbm-check { width: 18px; height: 18px; border: 1px solid var(--cbm-pill-border); border-radius: 4px; background: #fff; box-shadow: inset 0 0 0 2px #fff; }
  .cbm-filter.is-active .cbm-check { background: #3aa65a; border-color: #3aa65a; }

  .cbm-results__meta { display: flex; gap: 12px; align-items: baseline; margin-bottom: 12px; }
  .cbm-count { color: var(--color-foreground-secondary); }
  .cbm-reset { text-decoration: underline; color: var(--color-foreground); }

  .cbm-grid { list-style: none; padding: 0; margin: 0; display: grid; gap: 20px; }
  @media screen and (min-width: 750px) { .cbm-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); } }
  @media screen and (min-width: 990px) { .cbm-grid { grid-template-columns: repeat(3, minmax(0, 1fr)); } }

  .cbm-card { display: flex; flex-direction: column; background: #fff; border-radius: 12px; overflow: hidden; border: 1px solid #e6e6e6; box-shadow: 0 1px 2px rgba(0,0,0,.04); }
  .cbm-media { display: block; background: #fafafa; aspect-ratio: 4/3; }
  .cbm-img { width: 100%; height: 100%; object-fit: contain; display: block; }
  .cbm-ph { aspect-ratio: 4/3; background: #f4f4f4; }
  .cbm-card__content { padding: 16px; display: grid; gap: 10px; }
  .cbm-title { font-size: 1.35rem; margin: 0; }
  .cbm-excerpt { color: var(--color-foreground-secondary); font-size: .95rem; }
  .cbm-price { display: flex; gap: 10px; align-items: center; }
  .cbm-price--compare { text-decoration: line-through; color: var(--color-foreground-secondary); }
  .cbm-btn { appearance: none; border: 0; background: #3aa65a; color: #fff; padding: 12px 16px; border-radius: 999px; font-weight: 700; cursor: pointer; }
  .cbm-btn[disabled] { background: #b7c2b6; cursor: not-allowed; }

  .cbm-pagination { margin-top: 20px; display: flex; gap: 12px; justify-content: center; align-items: center; }
  .cbm-page { text-decoration: none; color: var(--color-foreground); padding: 8px 12px; border: 1px solid var(--cbm-pill-border); border-radius: 8px; }
  .cbm-page-count { color: var(--color-foreground-secondary); }
{% endstylesheet %}

{% schema %}
{
  "name": "Collection mirrored",
  "settings": [
    { "type": "collection", "id": "collection", "label": "Collection" },
    { "type": "text", "id": "toggle_label", "label": "Toggle label", "default": "Subscribe & Save 20%" },
    { "type": "text", "id": "toggle_tag", "label": "Toggle tag", "default": "Subscription" },
    { "type": "text", "id": "chip_1_label", "label": "Chip 1 label", "default": "Bundle & Save" },
    { "type": "text", "id": "chip_1_value", "label": "Chip 1 tag", "default": "Bundle" },
    { "type": "text", "id": "chip_2_label", "label": "Chip 2 label", "default": "Best Sellers" },
    { "type": "text", "id": "chip_2_value", "label": "Chip 2 tag", "default": "Best Seller" },
    { "type": "text", "id": "chip_3_label", "label": "Chip 3 label", "default": "Rheal x Vita Coco Bundles" },
    { "type": "text", "id": "chip_3_value", "label": "Chip 3 tag", "default": "Vita Coco" },
    { "type": "range", "id": "per_page", "label": "Products per page", "min": 6, "max": 48, "step": 6, "default": 24 },
    { "type": "color_scheme", "id": "color_scheme", "label": "Color scheme", "default": "scheme-1" },
    { "type": "range", "id": "padding_block_start", "label": "Top padding", "min": 0, "max": 100, "step": 1, "unit": "px", "default": 8 },
    { "type": "range", "id": "padding_block_end", "label": "Bottom padding", "min": 0, "max": 100, "step": 1, "unit": "px", "default": 8 }
  ],
  "presets": [
    { "name": "Collection mirrored" }
  ],
  "enabled_on": {
    "templates": ["index", "page", "collection"]
  }
}
{% endschema %}


