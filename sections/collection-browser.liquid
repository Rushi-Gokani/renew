
<script
  src="{{ 'results-list.js' | asset_url }}"
  type="module"
  fetchpriority="low"
></script>

{% liquid
  assign selected_collection = section.settings.collection | default: collections.all
%}

<div class="section-background color-{{ section.settings.color_scheme }}"></div>
<results-list
  class="section product-grid-container color-{{ section.settings.color_scheme }}"
  style="--padding-block-start: {{ section.settings.padding-block-start }}px; --padding-block-end: {{ section.settings.padding-block-end }}px;"
  section-id="{{ section.id }}"
>
  {% if section.settings.show_toolbar %}
    <div class="collection-browser__toolbar">
      {% if section.settings.show_primary_toggle %}
        {% assign toggle_active = false %}
        {% if request.query['filter.p.tag'] contains section.settings.primary_toggle_tag %}
          {% assign toggle_active = true %}
        {% endif %}
        <a
          class="cb-toggle {% if toggle_active %}is-active{% endif %}"
          href="{{ selected_collection.url | append: '?filter.p.tag=' | append: section.settings.primary_toggle_tag }}"
        >
          <span class="cb-toggle__switch" aria-hidden="true"></span>
          <span class="cb-toggle__label">{{ section.settings.primary_toggle_label }}</span>
        </a>
      {% endif %}

      <div class="cb-chips">
        {% for i in (1..6) %}
          {% assign label = section.settings["chip_" | append: i | append: "_label"] %}
          {% assign type = section.settings["chip_" | append: i | append: "_type"] %}
          {% assign value = section.settings["chip_" | append: i | append: "_value"] %}
          {% if label and value %}
            {% liquid
              assign qp = ''
              case type
                when 'tag'
                  assign qp = 'filter.p.tag='
                when 'product_type'
                  assign qp = 'filter.p.product_type='
                when 'vendor'
                  assign qp = 'filter.p.vendor='
              endcase
              assign href = selected_collection.url | append: '?' | append: qp | append: value
              assign is_active = request.query[qp | split: '=' | first] == value or request.query['filter.p.tag'] contains value
            %}
            <a class="cb-chip {% if is_active %}is-active{% endif %}" href="{{ href }}">
              {{- label -}}
            </a>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  {% endif %}
  {% render 'skip-to-content-link', href: '#ResultsList', text: 'accessibility.skip_to_results_list' %}

  <div
    class="collection-wrapper grid gap-style"
  >
    {% content_for 'block',
      type: 'filters',
      id: 'filters',
      results: selected_collection,
      results_size: selected_collection.products_count
    %}

    <div class="cb-results-row">
      <div class="cb-results-count">
        {{ 'Showing ' }}{{ selected_collection.products_count }}{{ ' results' }}
      </div>
      <a class="cb-reset" href="{{ selected_collection.url }}">{{ 'Reset all filters' }}</a>
    </div>

    {% paginate selected_collection.products by section.settings.per_page %}
      {% capture children %}
        {% for product in selected_collection.products %}
          <li
            id="{{ section.id }}-{{ product.id }}"
            class="product-grid__item product-grid__item--{{ forloop.index0 }}"
            data-page="{{ paginate.current_page }}"
            data-product-id="{{ product.id }}"
            ref="cards[]"
          >
            {% # theme-check-disable %}
            {% content_for 'block', type: '_product-card', id: 'product-card', closest.product: product %}
            {% # theme-check-enable %}
          </li>
        {% endfor %}
      {% endcapture %}

      {% render 'product-grid',
        section: section,
        children: children,
        products: selected_collection.products,
        paginate: paginate
      %}
    {% endpaginate %}
  </div>
</results-list>

{% stylesheet %}
  :root {
    --cb-chip-radius: 999px;
    --cb-chip-bg: #f0f3ed;
    --cb-chip-bg-active: #e3efe0;
    --cb-chip-border: #d7ddcf;
    --cb-toolbar-gap: 12px;
  }

  .collection-browser__toolbar {
    display: flex;
    flex-wrap: wrap;
    gap: var(--cb-toolbar-gap);
    align-items: center;
    margin-block-end: 16px;
    padding-inline: var(--page-margin);
  }

  .cb-toggle {
    --toggle-height: 34px;
    display: inline-flex;
    align-items: center;
    gap: 10px;
    background: var(--cb-chip-bg);
    border-radius: var(--cb-chip-radius);
    padding: 4px 14px 4px 8px;
    text-decoration: none;
    color: var(--color-foreground);
    border: 1px solid var(--cb-chip-border);
  }

  .cb-toggle__switch {
    width: var(--toggle-height);
    height: var(--toggle-height);
    border-radius: 999px;
    background: #d6ddcf;
    position: relative;
  }

  .cb-toggle__switch::after {
    content: '';
    position: absolute;
    top: 3px;
    left: 3px;
    width: calc(var(--toggle-height) - 6px);
    height: calc(var(--toggle-height) - 6px);
    border-radius: 50%;
    background: #fff;
    box-shadow: 0 1px 2px rgb(0 0 0 / 15%);
    transition: transform var(--animation-speed-fast) ease;
  }

  .cb-toggle.is-active {
    background: var(--cb-chip-bg-active);
    border-color: transparent;
  }

  .cb-toggle.is-active .cb-toggle__switch::after {
    transform: translateX(100%);
  }

  .cb-chip {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 14px;
    border-radius: var(--cb-chip-radius);
    background: var(--cb-chip-bg);
    color: var(--color-foreground);
    text-decoration: none;
    border: 1px solid var(--cb-chip-border);
    box-shadow: 0 1px 0 rgba(0,0,0,.04);
  }

  .cb-chip.is-active {
    background: var(--cb-chip-bg-active);
    border-color: transparent;
  }

  .cb-chip__icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 18px;
    height: 18px;
  }

  .cb-results-row {
    grid-column: var(--grid-column--mobile);
    display: flex;
    align-items: baseline;
    justify-content: flex-start;
    gap: 12px;
    margin: 0 0 12px 0;
  }
  @media screen and (min-width: 750px) {
    .cb-results-row {
      grid-column: var(--grid-column--desktop);
    }
  }
  .cb-results-count { color: var(--color-foreground-secondary); font-size: .95rem; }
  .cb-reset { color: var(--color-foreground); text-decoration: underline; }

  .collection-wrapper {
    @media screen and (min-width: 750px) {
      grid-template-columns:
        1fr repeat(
          var(--centered-column-number),
          minmax(0, calc((var(--page-width) - var(--page-margin) * 2) / var(--centered-column-number)))
        )
        1fr;
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Collection browser",
  "class": "ui-test-collection-browser",
  "settings": [
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "checkbox",
      "id": "show_toolbar",
      "label": "Show toolbar (toggle + chips)",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_primary_toggle",
      "label": "Show primary toggle",
      "default": true,
      "visible_if": "{{ section.settings.show_toolbar }}"
    },
    {
      "type": "text",
      "id": "primary_toggle_label",
      "label": "Primary toggle label",
      "default": "Subscribe & Save 20%",
      "visible_if": "{{ section.settings.show_toolbar and section.settings.show_primary_toggle }}"
    },
    {
      "type": "text",
      "id": "primary_toggle_tag",
      "label": "Primary toggle product tag",
      "info": "Tag to filter by when toggle is active",
      "default": "Subscription",
      "visible_if": "{{ section.settings.show_toolbar and section.settings.show_primary_toggle }}"
    },
    {
      "type": "header",
      "content": "Quick filter chips",
      "visible_if": "{{ section.settings.show_toolbar }}"
    },
    {
      "type": "paragraph",
      "content": "Each chip links to a filter query. Make sure your filters are enabled in Storefront filtering for best results.",
      "visible_if": "{{ section.settings.show_toolbar }}"
    },
    {
      "type": "text",
      "id": "chip_1_label",
      "label": "Chip 1 label",
      "default": "Bundle & Save",
      "visible_if": "{{ section.settings.show_toolbar }}"
    },
    {
      "type": "select",
      "id": "chip_1_type",
      "label": "Chip 1 filter type",
      "options": [
        { "value": "tag", "label": "Tag" },
        { "value": "product_type", "label": "Product type" },
        { "value": "vendor", "label": "Vendor" }
      ],
      "default": "tag",
      "visible_if": "{{ section.settings.show_toolbar }}"
    },
    {
      "type": "text",
      "id": "chip_1_value",
      "label": "Chip 1 value",
      "default": "Bundle",
      "visible_if": "{{ section.settings.show_toolbar }}"
    },
    {
      "type": "text",
      "id": "chip_2_label",
      "label": "Chip 2 label",
      "default": "Best Sellers",
      "visible_if": "{{ section.settings.show_toolbar }}"
    },
    {
      "type": "select",
      "id": "chip_2_type",
      "label": "Chip 2 filter type",
      "options": [
        { "value": "tag", "label": "Tag" },
        { "value": "product_type", "label": "Product type" },
        { "value": "vendor", "label": "Vendor" }
      ],
      "default": "tag",
      "visible_if": "{{ section.settings.show_toolbar }}"
    },
    {
      "type": "text",
      "id": "chip_2_value",
      "label": "Chip 2 value",
      "default": "Best Seller",
      "visible_if": "{{ section.settings.show_toolbar }}"
    },
    {
      "type": "text",
      "id": "chip_3_label",
      "label": "Chip 3 label",
      "default": "Rheal x Vita Coco Bundles",
      "visible_if": "{{ section.settings.show_toolbar }}"
    },
    {
      "type": "select",
      "id": "chip_3_type",
      "label": "Chip 3 filter type",
      "options": [
        { "value": "tag", "label": "Tag" },
        { "value": "product_type", "label": "Product type" },
        { "value": "vendor", "label": "Vendor" }
      ],
      "default": "tag",
      "visible_if": "{{ section.settings.show_toolbar }}"
    },
    {
      "type": "text",
      "id": "chip_3_value",
      "label": "Chip 3 value",
      "default": "Vita Coco",
      "visible_if": "{{ section.settings.show_toolbar }}"
    },
    {
      "type": "text",
      "id": "chip_4_label",
      "label": "Chip 4 label",
      "visible_if": "{{ section.settings.show_toolbar }}"
    },
    { "type": "select", "id": "chip_4_type", "label": "Chip 4 filter type", "options": [ {"value": "tag", "label": "Tag"}, {"value": "product_type", "label": "Product type"}, {"value": "vendor", "label": "Vendor"} ], "default": "tag", "visible_if": "{{ section.settings.show_toolbar }}" },
    { "type": "text", "id": "chip_4_value", "label": "Chip 4 value", "visible_if": "{{ section.settings.show_toolbar }}" },
    {
      "type": "range",
      "id": "per_page",
      "label": "Products per page",
      "min": 4,
      "max": 48,
      "step": 4,
      "default": 24
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:settings.color_scheme",
      "default": "scheme-1"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "t:settings.top_padding",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 8
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "t:settings.bottom_padding",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 8
    }
  ],
  "presets": [
    {
      "name": "Collection browser",
      "category": "t:categories.products"
    }
  ],
  "enabled_on": {
    "templates": ["index", "page", "collection", "list-collections", "search", "product"]
  }
}
{% endschema %}


